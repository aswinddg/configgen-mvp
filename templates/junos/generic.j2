# Configuración Modular - Juniper
# Generado automáticamente

{# --- WAN CONFIGURATION --- #}
{% if wan_enabled == 'Yes' %}
{% if wan_type == 'Static' %}
set interfaces {{ wan_interface }} unit 0 family inet address {{ wan_ip }}/{{ wan_mask }}
{% elif wan_type == 'DHCP' %}
set interfaces {{ wan_interface }} unit 0 family inet dhcp
{% endif %}
set interfaces {{ wan_interface }} unit 0 description "WAN Interface"

{% if wan_type == 'Static' %}
# Configurar ruta por defecto
set routing-options static route 0.0.0.0/0 next-hop {{ gateway }}
{% endif %}

# Configurar DNS
set system name-server {{ dns1 }}

# Zona untrust para WAN
set security zones security-zone untrust interfaces {{ wan_interface }}.0
{% endif %}

{# --- LAN CONFIGURATION --- #}
{% if lan_enabled == 'Yes' %}
{% if lan_type == 'VLAN' %}
set interfaces {{ lan_interface }} unit 0 family ethernet-switching vlan members vlan-trust
set vlans vlan-trust vlan-id 10
set vlans vlan-trust l3-interface irb.10
set interfaces irb unit 10 family inet address {{ lan_ip }}/{{ lan_mask }}
set security zones security-zone trust interfaces irb.10
{% elif lan_type == 'Interface' %}
set interfaces {{ lan_interface }} unit 0 family inet address {{ lan_ip }}/{{ lan_mask }}
set security zones security-zone trust interfaces {{ lan_interface }}.0
{% endif %}
{% endif %}

# Políticas de seguridad básicas
set security policies from-zone trust to-zone untrust policy allow-all match source-address any
set security policies from-zone trust to-zone untrust policy allow-all match destination-address any
set security policies from-zone trust to-zone untrust policy allow-all match application any
set security policies from-zone trust to-zone untrust policy allow-all then permit

{# --- NAT CONFIGURATION --- #}
{% if wan_enabled == 'Yes' and enable_nat == 'Yes' %}
# Configuración de NAT (Source NAT / PAT)
set security nat source rule-set trust-to-untrust from zone trust
set security nat source rule-set trust-to-untrust to zone untrust
set security nat source rule-set trust-to-untrust rule source-nat match source-address 0.0.0.0/0
set security nat source rule-set trust-to-untrust rule source-nat then source-nat interface
{% endif %}

# Configuración completada
